@page
@model PetCare.WebApp.Pages.Admin.Roles.IndexModel
@{
    ViewData["Title"] = "Permission Groups";
}

<h2><i class="bi bi-shield-lock"></i> Permission Groups (Roles)</h2>

<div class="card mt-4 shadow-sm border-0">
    <div class="card-header bg-white fw-bold">Create New Role</div>
    <div class="card-body">
        <form method="post" asp-page-handler="Create">
            <div class="input-group">
                <input name="roleName" class="form-control" placeholder="Enter role name (e.g. Manager)" required />
                <button type="submit" class="btn btn-success"><i class="bi bi-plus-lg me-2"></i>Add Role</button>
            </div>
        </form>
    </div>
</div>

<div class="card mt-4 shadow-sm border-0">
    <div class="card-body p-0">
        <table class="table table-hover mb-0">
            <thead class="table-light">
                <tr>
                    <th class="ps-4">Role Name</th>
                    <th class="text-end pe-4">Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var role in Model.Roles)
                {
                    <tr>
                        <td class="ps-4 align-middle">
                            <span class="badge bg-secondary fs-6 fw-normal">@role.Name</span>
                        </td>
                        <td class="text-end pe-4">
                            @if (role.Name != "Admin")
                            {
                                <button type="button"
                                        class="btn btn-sm btn-outline-danger"
                                        data-bs-toggle="modal"
                                        data-bs-target="#deleteConfirmModal"
                                        data-role-id="@role.Id"
                                        data-role-name="@role.Name">
                                    <i class="bi bi-trash"></i> Delete
                                </button>
                            }
                            else
                            {
                                <span class="text-muted small fst-italic">System Role</span>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title"><i class="bi bi-exclamation-triangle-fill me-2"></i>Confirm Deletion</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center py-4">
                <p class="mb-1">Are you sure you want to delete the role:</p>
                <h4 class="fw-bold text-danger" id="modalRoleName">RoleName</h4>
                <p class="text-muted small mt-2">This action cannot be undone. Users with this role might lose access.</p>
            </div>
            <div class="modal-footer bg-light d-flex justify-content-center">
                <button type="button" class="btn btn-secondary px-4" data-bs-dismiss="modal">Cancel</button>

                <form method="post" asp-page-handler="Delete">
                    <input type="hidden" name="id" id="modalRoleIdInput" />
                    <button type="submit" class="btn btn-danger px-4 fw-bold">
                        <i class="bi bi-trash-fill me-2"></i>Yes, Delete it
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        var deleteModal = document.getElementById('deleteConfirmModal');

        deleteModal.addEventListener('show.bs.modal', function (event) {

            var button = event.relatedTarget;

            var roleId = button.getAttribute('data-role-id');
            var roleName = button.getAttribute('data-role-name');

            var modalTitle = deleteModal.querySelector('#modalRoleName');
            var modalInput = deleteModal.querySelector('#modalRoleIdInput');

            modalTitle.textContent = roleName;
            modalInput.value = roleId;
        });
    </script>
}